<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <title>√öltimos Videos de YouTube</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #ff0000;
      --bg-dark: #0f0f0f;
      --bg-card: #1f1f1f;
      --text-primary: #ffffff;
      --text-secondary: #aaaaaa;
      --border: #303030;
      --success: #00ff00;
    }

    body {
      font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 1rem;
    }

    header {
      max-width: 1400px;
      margin: 0 auto 2rem;
      text-align: center;
      padding: 2rem 1rem;
    }

    h1 {
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      margin-bottom: 0.5rem;
    }

    .last-update {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .cache-badge {
      display: inline-block;
      margin-left: 0.5rem;
      padding: 0.25rem 0.5rem;
      background: var(--success);
      color: var(--bg-dark);
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .api-config {
      max-width: 600px;
      margin: 2rem auto;
      background: var(--bg-card);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .api-config h2 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }

    .api-config input {
      width: 100%;
      padding: 0.75rem;
      background: var(--bg-dark);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .api-config .cache-info {
      background: rgba(0, 255, 0, 0.1);
      border: 1px solid rgba(0, 255, 0, 0.3);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }

    .api-config .cache-info strong {
      color: var(--success);
    }

    .api-config button {
      width: 100%;
      padding: 0.75rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
      margin-bottom: 0.5rem;
    }

    .api-config button:hover {
      opacity: 0.9;
    }

    .api-config button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .api-config button.secondary {
      background: var(--border);
    }

    .api-config .info {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
    }

    .api-config .info a {
      color: var(--primary);
      text-decoration: none;
    }

    .loading {
      text-align: center;
      padding: 3rem;
      font-size: 1.2rem;
      color: var(--text-secondary);
    }

    .progress {
      max-width: 600px;
      margin: 2rem auto;
      text-align: center;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--primary);
      transition: width 0.3s;
      width: 0%;
    }

    .progress-text {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .quota-info {
      color: var(--success);
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }

    .error {
      background: #ff000020;
      border: 1px solid var(--primary);
      padding: 1rem;
      border-radius: 8px;
      margin: 2rem auto;
      max-width: 600px;
      text-align: center;
    }

    .category {
      max-width: 1400px;
      margin: 0 auto 3rem;
    }

    .category-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding: 0 0.5rem;
    }

    .category-title {
      font-size: clamp(1.3rem, 3vw, 1.8rem);
      font-weight: 600;
    }

    .category-count {
      background: var(--bg-card);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .videos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .video-card {
      background: var(--bg-card);
      border-radius: 12px;
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
      border: 1px solid var(--border);
    }

    .video-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    .video-thumbnail {
      position: relative;
      padding-top: 56.25%;
      background: var(--border);
      overflow: hidden;
    }

    .video-thumbnail img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.9);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .video-info {
      padding: 1rem;
    }

    .channel-name {
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .channel-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--border);
    }

    .video-title {
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .video-title a {
      color: var(--text-primary);
      text-decoration: none;
    }

    .video-title a:hover {
      color: var(--primary);
    }

    .video-meta {
      display: flex;
      gap: 0.5rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
      flex-wrap: wrap;
    }

    .meta-separator {
      color: var(--border);
    }

    footer {
      max-width: 1400px;
      margin: 4rem auto 2rem;
      text-align: center;
      padding: 2rem 1rem;
      border-top: 1px solid var(--border);
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .videos-grid {
        grid-template-columns: 1fr;
      }

      .category {
        margin-bottom: 2rem;
      }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
      .videos-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>üì∫ √öltimos Videos de YouTube</h1>
    <p class="last-update">
      √öltima actualizaci√≥n: <span id="updateTime">-</span>
      <span id="cacheBadge" class="cache-badge" style="display: none;">üì¶ Desde cach√©</span>
    </p>
  </header>

  <div id="apiConfig" class="api-config">
    <h2>‚öôÔ∏è Configuraci√≥n de API</h2>

    <div id="cacheStatus" class="cache-info" style="display: none;">
      <strong>‚úì Datos en cach√© disponibles</strong><br>
      √öltima carga: <span id="cacheTime">-</span><br>
      <small>Los datos se actualizan autom√°ticamente cada 6 horas</small>
    </div>

    <input type="text" id="apiKeyInput" placeholder="Ingresa tu YouTube API Key aqu√≠">
    <button id="loadButton" onclick="startLoading(false)">üîÑ Cargar Videos</button>
    <button id="loadCacheButton" onclick="loadFromCache()" class="secondary" style="display: none;">
      üì¶ Usar Cach√© (sin consumir cuota)
    </button>
    <button id="forceButton" onclick="startLoading(true)" class="secondary" style="display: none;">
      ‚ö° Forzar Actualizaci√≥n
    </button>

    <p class="info">
      <strong>Optimizado:</strong> Solo usa ~180 unidades de cuota (1.8% del l√≠mite diario)<br>
      El cach√© se actualiza autom√°ticamente cada 6 horas
    </p>
    <p class="info">
      ¬øNo tienes una API Key?
      <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">
        Obt√©n una aqu√≠
      </a>
    </p>
  </div>

  <main id="content"></main>

  <footer>
    <p>‚ú® Optimizado para consumir m√≠nima cuota de API</p>
    <p>M√©todo: Playlist Uploads + Cach√© Local (6 horas)</p>
  </footer>

  <script>
    // Configuraci√≥n
    const CACHE_KEY = 'youtube_videos_cache';
    const CACHE_TIME_KEY = 'youtube_videos_cache_time';
    const API_KEY_STORAGE = 'youtube_api_key';
    const CACHE_DURATION = 6 * 60 * 60 * 1000; // 6 horas

    // Canales con Channel IDs
    const channels = {
      'IA': [
        { name: 'Santiago Bilinkis', id: 'UCMwlWUY_R3only6kK4218Tg' },
        { name: 'DotCSV', id: 'UCy5znSnfMsDwaLlROnZ7Qbg' },
        { name: 'DotCSV Lab', id: 'UC7q7Kqf_YNRNUZZPuhdD1sA' },
        { name: 'Theoretically Media', id: 'UCYcult7VS5xvADr7TwOlJzw' },
        { name: 'Bob Doyle Media', id: 'UCtHaxi4GTYDpJgMSGy7AeSw' },
        { name: 'Mr. Eflow', id: 'UCOz1ikywLZ1Qzv_RQpQJa9Q' },
        { name: 'Pixivu', id: 'UCAiQJSWRJUPfQJPMZiT3rTw' },
        { name: 'La Inteligencia Artificial', id: 'UCb52BVQXl1dHOOMy65w6SLg' },
        { name: 'Migue Baena IA', id: 'UC_YMnVHvmxh5qkDMT7BqhCw' },
        { name: 'Xavier Mitjana', id: 'UCLFfayQYqnJ8PSfQDGhVbmQ' },
        { name: 'Tech Halla', id: 'UCIp0igMUxaBSBu1Lq7Y3uPg' },
        { name: 'Johan Solutions', id: 'UCGWl2tOy9-5vD6LJEj8fBbg' },
        { name: 'Futurepedia', id: 'UCTbFzklmhXYbqbKnDfxYosg' },
        { name: 'Matt VidPro', id: 'UCJ6KZTTnkE-s2XFJJmoTAkw' },
        { name: 'Curious Refuge', id: 'UCIyAVBEYdkIY8vKPzIBweOA' },
        { name: 'AI Webb TV', id: 'UCNt6n4fhXZ7eMDnCGvuU7xg' },
        { name: 'AI Controversy', id: 'UC93y2FpLvIY1b9M8AX2V0Eg' },
        { name: 'El Oma Quiabelo', id: 'UC2i7M42xLXhVTFTWPE3H0iw' },
        { name: 'We Are Nocode', id: 'UCQjQZKFLBPFkUWTCALYRXBg' },
        { name: 'Meydeey', id: 'UCL0xIvWvPvWDr2W5qfZ5rPQ' },
        { name: 'Bilawal Sidhu', id: 'UCNQnFOdh1q-zNUhshsVzRnQ' },
        { name: 'IA Sonora', id: 'UCDk8-oqAaQqV8L2GXgw4z5Q' },
        { name: 'Academia IA Lab', id: 'UC3_wHfx5HWgVj0UJ6fHkFKg' },
        { name: 'Mia Meow AI', id: 'UCaEP_XxNaLY2JjF6KCwNSmw' }
      ],
      'Web y Programaci√≥n': [
        { name: 'Chrome Devs', id: 'UCnUYZLuoy1rq1aVMwx4aTzw' },
        { name: 'Kevin Powell', id: 'UCJZv4d5rbIKd4QHMPkcABCw' },
        { name: 'General Musings', id: 'UCDNVGe5SsVgsnHYO9T4mnHw' },
        { name: 'midudev', id: 'UC8LeXCWOalN8SxlrPcG-PaQ' },
        { name: 'midu live', id: 'UCzNMJJd_tYEqCyoLyWxfL1w' },
        { name: 'Una Kravets', id: 'UCCKxLWd4Gb5tPVtdQ5e3s1w' },
        { name: 'Online Tutorials', id: 'UCbwXnUipZsLfUckBPsC7Jog' },
        { name: 'Codex Community', id: 'UCekJZvR9vMaGaYHRxZhiOcA' },
        { name: 'Flux Academy', id: 'UCN7dywl5wDxTu1RM3eJ_h9Q' },
        { name: 'Hyperplexed', id: 'UCmEzz-dPBVrsy4ZluSsYHDg' },
        { name: 'DesignCode', id: 'UCTIhfOopxukTIRkbXJ3kN-g' },
        { name: 'CodelyTV', id: 'UCTJxlHYtEzRHzoESEA2amdQ' },
        { name: 'Web Dev Simplified', id: 'UCFbNIlppjAuEX4znoulh0Cw' },
        { name: 'CSS Weekly', id: 'UCu5AdARGVLHhsGYWvmZ5uxA' },
        { name: 'Bedimcode', id: 'UCgkDs77BoEhMIgRUB4MKrtQ' },
        { name: 'Malewicz', id: 'UCTIhfOopxukTIRkbXJ3kN-g' },
        { name: 'DesignCourse', id: 'UCVyRiMvfUNMA1UPlDPzG5Ow' },
        { name: 'freeCodeCamp Espa√±ol', id: 'UC1emV4A8liRTuJPLtGiBUNw' },
        { name: 'Fazt Code', id: 'UCX9NJ471o7Wie1DQe94RVIg' },
        { name: 'Lun Developer', id: 'UCCDUg85zIC02Y6l3fJ2_Iqg' },
        { name: 'CSScapism', id: 'UCH89tXDUlPTB0qxvXqBqPiQ' },
        { name: 'Optimistic Web', id: 'UCOSYWxkqc4h-oN1Q5xULBlg' },
        { name: 'Snippets Code', id: 'UCcXKjq9VyXl8l6VGwjEP-jA' },
        { name: 'Coder Coder', id: 'UCzNf0liwUzMN6_pixbQlMhQ' },
        { name: 'Envato Tuts', id: 'UC8lxnUR_CzruT2KA6cb7p0Q' },
        { name: 'Orbit Media', id: 'UC7Hdlj7hH7TPgJDmE6a1L_A' },
        { name: 'Frontend FYI', id: 'UCrwLXiHNbV7RzUlKOXfYLaw' },
        { name: 'Design Sense', id: 'UCE8cJFKZYgHhOZC7k9hTU9A' },
        { name: 'Satori Graphics', id: 'UCoeJKtPJLoIBqWq4o8TDLpA' },
        { name: 'Creative Crew', id: 'UCqAKvl6K5_X2LWQSoXPProg' },
        { name: 'Coding2Go', id: 'UCkJRe4CgLk7g4VPR9Tn5H5A' },
        { name: 'Boroji Design', id: 'UCRpNIMrv1b4bkDJjIo2_r1A' },
        { name: 'Learn Web Code', id: 'UCHpGLpKlkmKWt8M0UuWKK-A' }
      ],
      'WordPress': [
        { name: 'Jamie WP', id: 'UCHpGLpKlkmKWt8M0UuWKK-A' },
        { name: 'WPTuts', id: 'UCyTrkfGVrW1d2jMqvM4bRcA' },
        { name: 'The Admin Bar', id: 'UCc9T4NdvKWWGHOVXDkYy59g' },
        { name: 'Brainstorm Force', id: 'UCzvqu_2GIiFJz8uO8mkECiw' },
        { name: 'David McCan', id: 'UCJkGRwwzB8VWQl1lslp7ZEw' },
        { name: 'Elmastudio', id: 'UCqDpd3-Y3Vl5-E8G9xYQJgA' },
        { name: 'WPCrafter', id: 'UCQbNyDz68SvK8qmgq0YM-Cw' },
        { name: 'Permaslug', id: 'UCO28lfrZQtMl6PzMUcN5S2Q' },
        { name: 'WP Soul', id: 'UCFALxv-AKE0c4O89ZiMd_CQ' },
        { name: 'WordPress', id: 'UCDAzOFtNHIYXf8T1xCcjSgg' },
        { name: 'Gutenberg Hub', id: 'UCRKxFqU0uP-KYwVnv0T-E6w' },
        { name: 'WP Jakson', id: 'UC7f23e5z2VjjnSTWTPEVhPg' }
      ],
      'Photoshop': [
        { name: 'Photolarium', id: 'UC4KnI6sE3w7D6v2KjjKCIqg' },
        { name: 'PiXimperfect', id: 'UCMrvLMUITAImCHMOhX88PYQ' },
        { name: 'Tripiyon', id: 'UCr9O4AXKJ7gV8PJNwV6kS2Q' },
        { name: 'Smart Graphic', id: 'UCnxkMGYKT42PkNEOJhSEU8g' },
        { name: 'Pixivu PS', id: 'UCAiQJSWRJUPfQJPMZiT3rTw' },
        { name: 'Learning Screen', id: 'UCpuB2hVPpvC1C8gMV_RwFTw' },
        { name: 'Steve Arnold Photo', id: 'UCQmD1x8CQVA4fmX8YDAP_zQ' },
        { name: 'PANTERvision', id: 'UCn-7ZRPxNYdBC0bHVnaAPPQ' }
      ]
    };

    let API_KEY = '';
    let totalUnitsUsed = 0;

    // Funci√≥n para formatear duraci√≥n ISO 8601
    function formatDuration(isoDuration) {
      const match = isoDuration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
      if (!match) return '0:00';

      const hours = (match[1] || '').replace('H', '');
      const minutes = (match[2] || '0').replace('M', '');
      const seconds = (match[3] || '0').replace('S', '');

      if (hours) {
        return `${hours}:${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')}`;
      }
      return `${minutes}:${seconds.padStart(2, '0')}`;
    }

    // Funci√≥n para formatear fecha relativa
    function formatRelativeTime(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
      const diffMinutes = Math.floor(diffMs / (1000 * 60));

      if (diffMinutes < 60) return `hace ${diffMinutes} min`;
      if (diffHours < 24) return `hace ${diffHours} h`;
      if (diffDays === 1) return 'hace 1 d√≠a';
      if (diffDays < 7) return `hace ${diffDays} d√≠as`;
      if (diffDays < 30) return `hace ${Math.floor(diffDays / 7)} sem`;
      return date.toLocaleDateString('es-AR', { day: '2-digit', month: 'short' });
    }

    // Funci√≥n para formatear n√∫mero de vistas
    function formatViews(views) {
      if (views >= 1000000) return `${(views / 1000000).toFixed(1)}M`;
      if (views >= 1000) return `${(views / 1000).toFixed(1)}K`;
      return views.toString();
    }

    // M√âTODO OPTIMIZADO: Usar Uploads Playlist (solo 2 unidades por canal)
    async function fetchLatestVideoOptimized(channelId, channelName) {
      try {
        // Convertir channel ID a uploads playlist ID
        // Verificar que el channelId comience con UC
        if (!channelId.startsWith('UC')) {
          console.error(`Channel ID inv√°lido para ${channelName}: ${channelId}`);
          return null;
        }
        const uploadsPlaylistId = 'UU' + channelId.substring(2);

        // Obtener el √∫ltimo video de la playlist (1 unidad)
        const playlistUrl = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${uploadsPlaylistId}&maxResults=1&key=${API_KEY}`;
        const playlistRes = await fetch(playlistUrl, {
          referrerPolicy: 'strict-origin-when-cross-origin'
        });

        if (!playlistRes.ok) {
          const errorText = await playlistRes.text();
          console.error(`Error HTTP ${playlistRes.status} para ${channelName}:`, errorText);
          throw new Error(`HTTP ${playlistRes.status}`);
        }

        const playlistData = await playlistRes.json();
        totalUnitsUsed += 1;

        if (playlistData.error) {
          console.error(`API Error para ${channelName}:`, playlistData.error);
          throw new Error(playlistData.error.message);
        }

        if (!playlistData.items || playlistData.items.length === 0) {
          console.warn(`No hay videos para: ${channelName}`);
          return null;
        }

        const video = playlistData.items[0].snippet;
        const videoId = video.resourceId.videoId;

        // Obtener detalles del video (1 unidad)
        const detailsUrl = `https://www.googleapis.com/youtube/v3/videos?part=contentDetails,statistics&id=${videoId}&key=${API_KEY}`;
        const detailsRes = await fetch(detailsUrl, {
          referrerPolicy: 'strict-origin-when-cross-origin'
        });

        if (!detailsRes.ok) {
          const errorText = await detailsRes.text();
          console.error(`Error HTTP ${detailsRes.status} en detalles:`, errorText);
          throw new Error(`HTTP ${detailsRes.status}`);
        }

        const detailsData = await detailsRes.json();
        totalUnitsUsed += 1;

        if (detailsData.error) {
          console.error(`API Error en detalles:`, detailsData.error);
          throw new Error(detailsData.error.message);
        }

        const details = detailsData.items[0];

        return {
          channelName: channelName,
          channelId: channelId,
          title: video.title,
          url: `https://www.youtube.com/watch?v=${videoId}`,
          thumbnail: video.thumbnails.medium.url,
          publishedAt: video.publishedAt,
          duration: formatDuration(details.contentDetails.duration),
          views: parseInt(details.statistics.viewCount) || 0
        };
      } catch (error) {
        console.error(`Error fetching ${channelName}:`, error);
        return null;
      }
    }

    // Funci√≥n para actualizar el progreso
    function updateProgress(current, total, channelName) {
      const percentage = Math.round((current / total) * 100);
      const progressFill = document.querySelector('.progress-fill');
      const progressText = document.querySelector('.progress-text');
      const quotaInfo = document.querySelector('.quota-info');

      if (progressFill) progressFill.style.width = `${percentage}%`;
      if (progressText) progressText.textContent = `Cargando ${current} de ${total} canales... (${channelName})`;
      if (quotaInfo) quotaInfo.textContent = `Unidades de cuota usadas: ${totalUnitsUsed} / 10,000`;
    }

    // Funci√≥n para cargar todos los videos
    async function loadRealVideos() {
      const content = document.getElementById('content');
      content.innerHTML = `
                <div class="progress">
                    <p class="progress-text">Iniciando carga optimizada...</p>
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <p class="quota-info">Unidades de cuota usadas: 0 / 10,000</p>
                </div>
            `;

      totalUnitsUsed = 0;
      const videosByCategory = {};
      let totalChannels = 0;
      let currentChannel = 0;

      // Contar total de canales
      for (const channelList of Object.values(channels)) {
        totalChannels += channelList.length;
      }

      // Cargar videos por categor√≠a
      for (const [category, channelList] of Object.entries(channels)) {
        videosByCategory[category] = [];

        for (const channel of channelList) {
          currentChannel++;
          updateProgress(currentChannel, totalChannels, channel.name);

          const video = await fetchLatestVideoOptimized(channel.id, channel.name);
          if (video) {
            videosByCategory[category].push(video);
          }

          // Pausa corta
          await new Promise(resolve => setTimeout(resolve, 100));
        }
      }

      // Guardar en cach√©
      saveToCache(videosByCategory);

      return videosByCategory;
    }

    // Funciones de cach√©
    function saveToCache(data) {
      try {
        localStorage.setItem(CACHE_KEY, JSON.stringify(data));
        localStorage.setItem(CACHE_TIME_KEY, Date.now().toString());
      } catch (e) {
        console.error('Error guardando en cach√©:', e);
      }
    }

    function getFromCache() {
      try {
        const data = localStorage.getItem(CACHE_KEY);
        const time = localStorage.getItem(CACHE_TIME_KEY);

        if (!data || !time) return null;

        const cacheAge = Date.now() - parseInt(time);
        if (cacheAge > CACHE_DURATION) return null;

        return {
          data: JSON.parse(data),
          timestamp: parseInt(time)
        };
      } catch (e) {
        console.error('Error leyendo cach√©:', e);
        return null;
      }
    }

    // Funci√≥n para renderizar videos
    function renderVideos(videosByCategory, fromCache = false) {
      const content = document.getElementById('content');
      content.innerHTML = '';

      let totalVideos = 0;
      for (const videos of Object.values(videosByCategory)) {
        totalVideos += videos.length;
      }

      if (totalVideos === 0) {
        content.innerHTML = '<div class="error">‚ùå No se pudieron cargar videos. Verifica tu API Key.</div>';
        return;
      }

      for (const [category, videos] of Object.entries(videosByCategory)) {
        if (videos.length === 0) continue;

        const section = document.createElement('section');
        section.className = 'category';

        const header = document.createElement('div');
        header.className = 'category-header';
        header.innerHTML = `
                    <h2 class="category-title">${category}</h2>
                    <span class="category-count">${videos.length} canales</span>
                `;

        const grid = document.createElement('div');
        grid.className = 'videos-grid';

        videos.forEach(video => {
          const card = document.createElement('article');
          card.className = 'video-card';
          card.innerHTML = `
                        <div class="video-thumbnail">
                            <img src="${video.thumbnail}" alt="${video.title}" loading="lazy">
                            <span class="video-duration">${video.duration}</span>
                        </div>
                        <div class="video-info">
                            <div class="channel-name">
                                <div class="channel-icon"></div>
                                <span>${video.channelName}</span>
                            </div>
                            <h3 class="video-title">
                                <a href="${video.url}" target="_blank" rel="noopener noreferrer">
                                    ${video.title}
                                </a>
                            </h3>
                            <div class="video-meta">
                                <span>${formatViews(video.views)} vistas</span>
                                <span class="meta-separator">‚Ä¢</span>
                                <span>${formatRelativeTime(video.publishedAt)}</span>
                            </div>
                        </div>
                    `;
          grid.appendChild(card);
        });

        section.appendChild(header);
        section.appendChild(grid);
        content.appendChild(section);
      }

      // Actualizar tiempo
      const now = new Date();
      document.getElementById('updateTime').textContent =
        now.toLocaleString('es-AR', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

      const cacheBadge = document.getElementById('cacheBadge');
      cacheBadge.style.display = fromCache ? 'inline-block' : 'none';

      // Mostrar resumen de cuota usada
      if (!fromCache && totalUnitsUsed > 0) {
        const summary = document.createElement('div');
        summary.className = 'api-config';
        summary.style.marginTop = '2rem';
        summary.innerHTML = `
                    <h2>üìä Resumen de consumo</h2>
                    <div class="cache-info">
                        <strong>‚úì Carga completada exitosamente</strong><br>
                        Unidades de cuota usadas: <strong>${totalUnitsUsed}</strong> de 10,000<br>
                        Porcentaje usado: <strong>${((totalUnitsUsed / 10000) * 100).toFixed(2)}%</strong><br>
                        Videos cargados: <strong>${totalVideos}</strong><br>
                        <small>Los datos se guardaron en cach√© local por 6 horas</small>
                    </div>
                `;
        content.appendChild(summary);
      }
    }

    // Funci√≥n para cargar desde cach√©
    function loadFromCache() {
      const cached = getFromCache();
      if (cached) {
        renderVideos(cached.data, true);
        document.getElementById('apiConfig').style.display = 'none';

        const cacheTime = new Date(cached.timestamp);
        document.getElementById('updateTime').textContent =
          cacheTime.toLocaleString('es-AR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
      }
    }

    // Funci√≥n para iniciar la carga
    async function startLoading(forceRefresh = false) {
      const input = document.getElementById('apiKeyInput');
      const button = document.getElementById('loadButton');
      const forceButton = document.getElementById('forceButton');
      const apiConfig = document.getElementById('apiConfig');

      API_KEY = input.value.trim() || localStorage.getItem(API_KEY_STORAGE) || '';

      if (!API_KEY) {
        alert('Por favor ingresa una API Key v√°lida');
        return;
      }

      // Guardar API Key
      localStorage.setItem(API_KEY_STORAGE, API_KEY);

      // Verificar cach√©
      const cached = getFromCache();
      if (cached && !forceRefresh) {
        const cacheAge = Date.now() - cached.timestamp;
        const remainingTime = CACHE_DURATION - cacheAge;
        const remainingHours = Math.floor(remainingTime / (1000 * 60 * 60));
        const remainingMinutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));

        const useCache = confirm(
          `Hay datos en cach√© de hace ${Math.floor(cacheAge / (1000 * 60))} minutos.\n\n` +
          `Se actualizar√°n autom√°ticamente en ${remainingHours}h ${remainingMinutes}m.\n\n` +
          `¬øQuieres usar el cach√© (sin consumir cuota) o actualizar ahora?`
        );

        if (useCache) {
          loadFromCache();
          return;
        }
      }

      button.disabled = true;
      if (forceButton) forceButton.disabled = true;
      button.textContent = 'Cargando...';

      try {
        const videosByCategory = await loadRealVideos();
        renderVideos(videosByCategory, false);
        apiConfig.style.display = 'none';
      } catch (error) {
        console.error('Error al cargar videos:', error);
        document.getElementById('content').innerHTML =
          `<div class="error">‚ùå Error: ${error.message}<br><br>Unidades usadas antes del error: ${totalUnitsUsed}</div>`;
        button.disabled = false;
        if (forceButton) forceButton.disabled = false;
        button.textContent = 'üîÑ Cargar Videos';
      }
    }

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', () => {
      const savedKey = localStorage.getItem(API_KEY_STORAGE);
      if (savedKey) {
        document.getElementById('apiKeyInput').value = savedKey;
      }

      const cached = getFromCache();
      if (cached) {
        const cacheStatus = document.getElementById('cacheStatus');
        const loadCacheButton = document.getElementById('loadCacheButton');
        const forceButton = document.getElementById('forceButton');

        cacheStatus.style.display = 'block';
        loadCacheButton.style.display = 'block';
        forceButton.style.display = 'block';

        const cacheTime = new Date(cached.timestamp);
        document.getElementById('cacheTime').textContent =
          cacheTime.toLocaleString('es-AR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });

        loadFromCache();
      }

      const input = document.getElementById('apiKeyInput');
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          startLoading(false);
        }
      });
    });
  </script>
</body>

</html>